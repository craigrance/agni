## Resolver for Mutation.createRegisteredUser
{
  "version": "2017-02-28",
  "operation": "PutItem",
  "key": {
  	 "displayName" : { "S" : "${context.arguments.input.displayName}" }
  },

  "attributeValues" : {
      "createdDate": { "N" : ${util.time.nowEpochMilliSeconds()} },
      "accountName" : { "S" : "${context.arguments.input.accountName}" },
      "data": { "S" : "${context.arguments.input.data}" },
      "postCountStartDate": { "N" : 0 },
      "postCount": { "N": 0 },
      "status": { "S": "${context.arguments.input.status}" }
  },
  "condition": {
    "expression": "attribute_not_exists(displayName)"
  }
}

$util.toJson($context.result)

## Resolver for Mutation.setCognitoIdentityId
{
  "version" : "2017-02-28",
  "operation" : "UpdateItem",
  
  #set ($accountName = $context.identity.username)
  #set ($displayName = $accountName.substring(96))
  
  "key" : {
      "displayName" : { "S" : "${displayName}" }
  },
  "update" : {
      "expression" : "SET cognitoIdentityId = :cognitoIdentityId",
      "expressionValues": {
          ":cognitoIdentityId" : { "S": "${context.arguments.input.cognitoIdentityId}" }
      }
  }
}

$util.toJson($context.result)

## Resolver for Mutation.deleteRegisteredUser
{
    "version" : "2017-02-28",
    "operation" : "DeleteItem",
    "key" : {
        "displayName" : { "S" : "${context.arguments.input.displayName}" }
    }
}

$util.toJson($context.result)

## Resolver for Mutation.prepareSetPostData
#set($currentDate=${util.time.nowEpochMilliSeconds()})
#set($effectivePeriod=86400000)
{
  "version" : "2017-02-28",
  "operation" : "UpdateItem",
  "key" : {
      "displayName" : { "S" : "${context.arguments.input.displayName}" }
  },
  "update" : {
      "expression" : "SET postCount = :zero",
      "expressionValues": {
          ":zero" : { "N": 0 }
      }
  },
  "condition" : {
        "expression"       : ":currentDate - lastPostDate > :effectivePeriod",
        "expressionValues" : {
            ":currentDate" : $currentDate,
            ":effectivePeriod" : $effectivePeriod
        }
    }
}

$util.toJson($context.result)

## Resolver for Mutation.setPostData
{
  "version" : "2017-02-28",
  "operation" : "UpdateItem",
  "key" : {
      "displayName" : { "S" : "${context.arguments.input.displayName}" }
  },
  "update" : {
      "expression" : "SET lastPostDate = :lastPostDate, postCount = postCount + :increment",
      "expressionValues": {
          ":lastPostDate" : { "N": ${util.time.nowEpochMilliSeconds()} },
          ":increment" : { "N": 1 }
      }
  }
}

$util.toJson($context.result)

## Resolver for Query.getDisplayName
{
    "version" : "2017-02-28",
    "operation" : "GetItem",
    "key" : {
        "displayName" : { "S" : "${context.arguments.input.displayName}" }
    }
}

$util.toJson($context.result)

## Resolver for Query.getCreatedDate
{
    "version" : "2017-02-28",
    "operation" : "GetItem",
    "key" : {
        "displayName" : { "S" : "${context.arguments.input.displayName}" }
    }
}

$util.toJson($context.result)

## Resolver for Query.getAccountName
{
  "version" : "2017-02-28",
  "operation" : "Query",
  "index" : "cognitoIdentityId-index",
  "query" : {
    "expression": "cognitoIdentityId = :cognitoIdentityId",
      "expressionValues" : {
        ":cognitoIdentityId" : { "S" : "${context.arguments.input.cognitoIdentityId}" }
      }
  }
}

{
  "accountName": $utils.toJson($context.result.items[0]["accountName"])
}