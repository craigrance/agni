## Resolver for Mutation.createScreen
#set($screenName = ${context.arguments.input.screenName})
#set($objectKey = ${context.arguments.input.objectKey})
#set($createdDate = ${util.time.nowEpochMilliSeconds()})
#set($posterId = ${context.arguments.input.posterId})
#set($type = ${context.arguments.input.type})
#set($labelsForSuggester = ${context.arguments.input.labelsForSuggester})
#set($labelsForSearch = ${context.arguments.input.labelsForSearch})
#set($userCount = 0)
{
  "version" : "2017-02-28",
  "operation" : "POST",
  "path" : ${util.toJson("/screens/_doc/")},
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      #if($type == "thumbnail")
        "screenName" : "$screenName",
        "objectKey" : "$objectKey",
        "createdDate" : "$createdDate",
        "posterId" : "$posterId",
        "type" : "$type",
        "labelsForSuggester" : ${utils.toJson($labelsForSuggester)},
        "labelsForSearch" : ${utils.toJson($labelsForSearch)},
        "userCount" : "$userCount",
        "status" : "init"
      #else
        "screenName" : "$screenName",
        "objectKey" : "$objectKey",
        "createdDate" : "$createdDate",
        "type" : "$type",
        "status" : "init"
      #end
    }
  }
}

${utils.toJson(${context.result.get("_source")})}

## Resolver for Mutation.changePosterId
#set($posterId = ${context.arguments.input.posterId})
#set($changedPosterId = "Anonymous")
{
  "version" : "2017-02-28",
  "operation" : "POST",
  "path" : ${util.toJson("/screens/_update_by_query?conflicts=proceed")},
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      "query" : { 
        "term" : {
          "posterId" : "$posterId"
        }
      },
      "script" : {
        "inline": "ctx._source.posterId = \"$changedPosterId\""
      }
    }
  }
}

${utils.toJson(${context.result})}

## Resolver for Query.getObjectKeys
#set($objectKey = ${context.arguments.input.objectKey})
{
  "version" : "2017-02-28",
  "operation" : "GET",
  "path" : ${util.toJson("/screens/_search")},
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      "from" : 0,
      "size" : 1,
      "query" : {
        "term" : {
          "objectKey" : "$objectKey"
        }
      },
      "_source" : ["objectKey"]
    }
  }
}

[
  #foreach($entry in ${context.result.hits.hits})
    #if($velocityCount > 1), #end
      ${utils.toJson(${entry.get("_source")})}
  #end
]