## Resolver for Mutation.createScreen
#set($path = ${util.toJson("/screens/_doc/")})
#set($screenName = ${context.arguments.input.screenName})
#set($objectKey = ${context.arguments.input.objectKey})
#set($createdDate = ${util.time.nowEpochMilliSeconds()})
#set($posterId = ${context.arguments.input.posterId})
#set($type = ${context.arguments.input.type})
#set($labels = ${utils.toJson(${context.arguments.input.labels})})
{
  "version" : "2017-02-28",
  "operation" : "POST",
  "path" : $path,
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      #if($type == "thumbnail")
        "screenName" : "$screenName",
        "objectKey" : "$objectKey",
        "createdDate" : "$createdDate",
        "posterId" : "$posterId",
        "type" : "$type",
        "labels" : $labels,
        "userCount" : 0,
        "status" : "init"
      #else
        "screenName" : "$screenName",
        "objectKey" : "$objectKey",
        "createdDate" : "$createdDate",
        "type" : "$type",
      #end
    }
  }
}

${utils.toJson(${context.result.get("_source")})}

## Resolver for Mutation.changePosterId
#set($path = ${util.toJson("/screens/_update_by_query?conflicts=proceed")})
#set($posterId = ${context.arguments.input.posterId})
#set($changedPosterId = "Anonymous")
{
  "version" : "2017-02-28",
  "operation" : "POST",
  "path" : $path,
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      "query" : { 
        "term" : {
          "posterId" : "$posterId"
        }
      },
      "script" : {
        "inline": "ctx._source.posterId = \"$changedPosterId\""
      }
    }
  }
}

${utils.toJson(${context.result})}

## Resolver for Query.getObjectKeys
#set($path = ${util.toJson("/screens/_search")})
#set($objectKey = ${context.arguments.input.objectKey})
{
  "version" : "2017-02-28",
  "operation" : "GET",
  "path" : $path,
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      "from" : 0,
      "size" : 1,
      "query" : {
        "term" : {
          "objectKey" : "$objectKey"
        }
      },
      "_source" : ["objectKey"]
    }
  }
}

[
  #foreach($entry in ${context.result.hits.hits})
    #if($velocityCount > 1), #end
      ${utils.toJson(${entry.get("_source")})}
  #end
]

## Resolver for Query.getScreenNames
#set($path = ${util.toJson("/screens/_search")})
#set($size = 12)
#set($type = ${context.arguments.input.type})
{
  "version" : "2017-02-28",
  "operation" : "GET",
  "path" : $path,
  "params" : {
    "headers" : {},
    "queryString" : {},
    "body" : {
      "from" : 0,
      "size" : "$size",
      "query" : {
        "term" : {
          "type" : "$type"
        }
      },
      "_source" : ["screenName"]
    }
  }
}

[
  #foreach($entry in ${context.result.hits.hits})
    #if($velocityCount > 1), #end
      ${utils.toJson(${entry.get("_source")})}
  #end
]